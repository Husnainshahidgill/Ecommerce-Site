{
    "sourceFile": "views/site/cart.ejs",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1765397697965,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766086011647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,81 +6,76 @@\n     <p class=\"text-muted mb-0\">Review your items before checkout.</p>\r\n   </div>\r\n \r\n   <div class=\"d-flex gap-2\">\r\n-    <a href=\"/\" class=\"btn btn-outline-primary\">\r\n-      ‚Üê Continue Shopping\r\n-    </a>\r\n-    <a href=\"/checkout\" class=\"btn btn-primary\">\r\n-      Proceed to Checkout\r\n-    </a>\r\n+    <a href=\"/\" class=\"btn btn-outline-primary\">‚Üê Continue Shopping</a>\r\n+    <a href=\"/checkout\" class=\"btn btn-primary\">Proceed to Checkout</a>\r\n   </div>\r\n </div>\r\n \r\n-<% if (!products || products.length === 0) { %>\r\n+<%\r\n+  const cartItems = (typeof items !== 'undefined' && Array.isArray(items)) ? items : [];\r\n+%>\r\n+\r\n+<% if (!cartItems || cartItems.length === 0) { %>\r\n   <div class=\"card border-0 shadow-sm\">\r\n     <div class=\"card-body p-4 p-md-5 text-center\">\r\n       <div class=\"display-6 mb-2\">üõí</div>\r\n       <h2 class=\"h5 fw-semibold\">Your cart is empty</h2>\r\n       <p class=\"text-muted mb-4\">Looks like you haven‚Äôt added anything yet.</p>\r\n-      <a href=\"/\" class=\"btn btn-primary px-4\">\r\n-        Start Shopping\r\n-      </a>\r\n+      <a href=\"/\" class=\"btn btn-primary px-4\">Start Shopping</a>\r\n     </div>\r\n   </div>\r\n <% } else { %>\r\n \r\n   <div class=\"card border-0 shadow-sm\">\r\n     <div class=\"card-body p-0\">\r\n-\r\n       <div class=\"table-responsive\">\r\n         <table class=\"table table-hover align-middle mb-0\">\r\n           <thead class=\"table-light\">\r\n             <tr>\r\n-              <th class=\"ps-4\">Product Name</th>\r\n-              <th class=\"text-end pe-4\">Product Price</th>\r\n+              <th class=\"ps-4\">Product</th>\r\n+              <th class=\"text-center\">Qty</th>\r\n+              <th class=\"text-end\">Unit Price</th>\r\n+              <th class=\"text-end pe-4\">Line Total</th>\r\n             </tr>\r\n           </thead>\r\n \r\n-          <!-- =========================================\r\n-               BUGGY ORIGINAL (invalid HTML structure)\r\n-               tfoot was inside tbody.\r\n-          ========================================== -->\r\n-          <% if (false) { %>\r\n-            <tbody>\r\n-              <% for(var i=0;i<products.length;i++) {let product = products[i];%>\r\n-                <tr>\r\n-                  <td><%=product.name  %> </td>\r\n-                  <td><%=product.price  %> </td>\r\n-                </tr>\r\n-              <% } %> \r\n-              <tfoot>\r\n-                <tr>\r\n-                  <td>Total:</td>\r\n-                  <td><%=total  %> </td>\r\n-                </tr>\r\n-              </tfoot>\r\n-            </tbody>\r\n-          <% } %>\r\n-\r\n-          <!-- ‚úÖ Fixed structure -->\r\n           <tbody>\r\n-            <% for (var i = 0; i < products.length; i++) { let product = products[i]; %>\r\n+            <% for (var i = 0; i < cartItems.length; i++) { \r\n+                 let it = cartItems[i];\r\n+                 let product = it.product;\r\n+                 let qty = Number(it.qty || 1);\r\n+                 let unit = Number(product && product.price ? product.price : 0);\r\n+                 let line = Number(it.lineTotal || (unit * qty));\r\n+            %>\r\n               <tr>\r\n                 <td class=\"ps-4\">\r\n-                  <div class=\"fw-semibold\"><%= product.name %></div>\r\n-                  <div class=\"text-muted small\">Item <%= i + 1 %></div>\r\n+                  <div class=\"fw-semibold\"><%= product ? product.name : 'Unknown Product' %></div>\r\n+                  <div class=\"text-muted small\">\r\n+                    <% if (product && product.department) { %><%= product.department %><% } %>\r\n+                    <% if (product && product.color) { %> ‚Ä¢ <%= product.color %><% } %>\r\n+                  </div>\r\n                 </td>\r\n+\r\n+                <td class=\"text-center\">\r\n+                  <span class=\"badge bg-secondary-subtle text-dark border\"><%= qty %></span>\r\n+                </td>\r\n+\r\n+                <td class=\"text-end\">\r\n+                  <%= unit %>\r\n+                </td>\r\n+\r\n                 <td class=\"text-end pe-4 fw-semibold\">\r\n-                  <%= product.price %>\r\n+                  <%= line %>\r\n                 </td>\r\n               </tr>\r\n             <% } %>\r\n           </tbody>\r\n \r\n           <tfoot class=\"table-light\">\r\n             <tr>\r\n-              <td class=\"ps-4\">\r\n+              <td class=\"ps-4\" colspan=\"3\">\r\n                 <span class=\"fw-semibold\">Total</span>\r\n               </td>\r\n               <td class=\"text-end pe-4\">\r\n                 <span class=\"fw-bold fs-5\"><%= total %></span>\r\n@@ -89,9 +84,8 @@\n           </tfoot>\r\n \r\n         </table>\r\n       </div>\r\n-\r\n     </div>\r\n   </div>\r\n \r\n   <div class=\"d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-3\">\r\n@@ -99,14 +93,10 @@\n       Prices shown are before delivery/taxes (if applicable).\r\n     </small>\r\n \r\n     <div class=\"d-flex gap-2\">\r\n-      <a href=\"/\" class=\"btn btn-outline-primary\">\r\n-        ‚Üê Continue Shopping\r\n-      </a>\r\n-      <a href=\"/checkout\" class=\"btn btn-primary\">\r\n-        Proceed to Checkout\r\n-      </a>\r\n+      <a href=\"/\" class=\"btn btn-outline-primary\">‚Üê Continue Shopping</a>\r\n+      <a href=\"/checkout\" class=\"btn btn-primary\">Proceed to Checkout</a>\r\n     </div>\r\n   </div>\r\n \r\n <% } %>\r\n"
                },
                {
                    "date": 1766086265591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,9 @@\n </div>\r\n \r\n <%\r\n   const cartItems = (typeof items !== 'undefined' && Array.isArray(items)) ? items : [];\r\n+  const money = (n) => Number(n || 0).toFixed(2);\r\n %>\r\n \r\n <% if (!cartItems || cartItems.length === 0) { %>\r\n   <div class=\"card border-0 shadow-sm\">\r\n@@ -35,39 +36,58 @@\n             <tr>\r\n               <th class=\"ps-4\">Product</th>\r\n               <th class=\"text-center\">Qty</th>\r\n               <th class=\"text-end\">Unit Price</th>\r\n-              <th class=\"text-end pe-4\">Line Total</th>\r\n+              <th class=\"text-end\">Line Total</th>\r\n+              <th class=\"text-end pe-4\">Actions</th>\r\n             </tr>\r\n           </thead>\r\n \r\n           <tbody>\r\n-            <% for (var i = 0; i < cartItems.length; i++) { \r\n+            <% for (var i = 0; i < cartItems.length; i++) {\r\n                  let it = cartItems[i];\r\n                  let product = it.product;\r\n                  let qty = Number(it.qty || 1);\r\n-                 let unit = Number(product && product.price ? product.price : 0);\r\n+                 let unit = Number(it.unitPrice || (product && product.price ? product.price : 0));\r\n                  let line = Number(it.lineTotal || (unit * qty));\r\n+                 let available = (product && product.quantity != null) ? Number(product.quantity) : 0;\r\n             %>\r\n               <tr>\r\n                 <td class=\"ps-4\">\r\n                   <div class=\"fw-semibold\"><%= product ? product.name : 'Unknown Product' %></div>\r\n                   <div class=\"text-muted small\">\r\n                     <% if (product && product.department) { %><%= product.department %><% } %>\r\n                     <% if (product && product.color) { %> ‚Ä¢ <%= product.color %><% } %>\r\n+                    <% if (product) { %> ‚Ä¢ Stock: <%= available %><% } %>\r\n                   </div>\r\n                 </td>\r\n \r\n-                <td class=\"text-center\">\r\n-                  <span class=\"badge bg-secondary-subtle text-dark border\"><%= qty %></span>\r\n+                <td class=\"text-center\" style=\"min-width: 180px;\">\r\n+                  <form method=\"POST\" action=\"/cart/update/<%= product._id %>\" class=\"d-flex justify-content-center gap-2\">\r\n+                    <input\r\n+                      type=\"number\"\r\n+                      name=\"qty\"\r\n+                      class=\"form-control form-control-sm\"\r\n+                      style=\"max-width: 90px;\"\r\n+                      min=\"1\"\r\n+                      max=\"<%= available > 0 ? available : 1 %>\"\r\n+                      value=\"<%= qty %>\"\r\n+                      required\r\n+                    />\r\n+                    <button class=\"btn btn-sm btn-outline-dark\">Update</button>\r\n+                  </form>\r\n                 </td>\r\n \r\n-                <td class=\"text-end\">\r\n-                  <%= unit %>\r\n-                </td>\r\n+                <td class=\"text-end\">$<%= money(unit) %></td>\r\n \r\n-                <td class=\"text-end pe-4 fw-semibold\">\r\n-                  <%= line %>\r\n+                <td class=\"text-end fw-semibold\">$<%= money(line) %></td>\r\n+\r\n+                <td class=\"text-end pe-4\">\r\n+                  <form method=\"POST\" action=\"/cart/remove/<%= product._id %>\" class=\"d-inline\">\r\n+                    <button class=\"btn btn-sm btn-outline-danger\" onclick=\"return confirm('Remove this item?')\">\r\n+                      Remove\r\n+                    </button>\r\n+                  </form>\r\n                 </td>\r\n               </tr>\r\n             <% } %>\r\n           </tbody>\r\n@@ -76,11 +96,12 @@\n             <tr>\r\n               <td class=\"ps-4\" colspan=\"3\">\r\n                 <span class=\"fw-semibold\">Total</span>\r\n               </td>\r\n-              <td class=\"text-end pe-4\">\r\n-                <span class=\"fw-bold fs-5\"><%= total %></span>\r\n+              <td class=\"text-end\">\r\n+                <span class=\"fw-bold fs-5\">$<%= money(total) %></span>\r\n               </td>\r\n+              <td class=\"pe-4\"></td>\r\n             </tr>\r\n           </tfoot>\r\n \r\n         </table>\r\n"
                },
                {
                    "date": 1766093728122,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,33 +61,39 @@\n                   </div>\r\n                 </td>\r\n \r\n                 <td class=\"text-center\" style=\"min-width: 180px;\">\r\n-                  <form method=\"POST\" action=\"/cart/update/<%= product._id %>\" class=\"d-flex justify-content-center gap-2\">\r\n-                    <input\r\n-                      type=\"number\"\r\n-                      name=\"qty\"\r\n-                      class=\"form-control form-control-sm\"\r\n-                      style=\"max-width: 90px;\"\r\n-                      min=\"1\"\r\n-                      max=\"<%= available > 0 ? available : 1 %>\"\r\n-                      value=\"<%= qty %>\"\r\n-                      required\r\n-                    />\r\n-                    <button class=\"btn btn-sm btn-outline-dark\">Update</button>\r\n-                  </form>\r\n+                  <% if (product) { %>\r\n+                    <form method=\"POST\" action=\"/cart/update/<%= product._id %>\" class=\"d-flex justify-content-center gap-2\">\r\n+                      <input\r\n+                        type=\"number\"\r\n+                        name=\"qty\"\r\n+                        class=\"form-control form-control-sm\"\r\n+                        style=\"max-width: 90px;\"\r\n+                        min=\"1\"\r\n+                        max=\"<%= available > 0 ? available : 1 %>\"\r\n+                        value=\"<%= qty %>\"\r\n+                        required\r\n+                      />\r\n+                      <button class=\"btn btn-sm btn-outline-dark\">Update</button>\r\n+                    </form>\r\n+                  <% } else { %>\r\n+                    <span class=\"text-muted small\">Item unavailable</span>\r\n+                  <% } %>\r\n                 </td>\r\n \r\n                 <td class=\"text-end\">$<%= money(unit) %></td>\r\n \r\n                 <td class=\"text-end fw-semibold\">$<%= money(line) %></td>\r\n \r\n                 <td class=\"text-end pe-4\">\r\n-                  <form method=\"POST\" action=\"/cart/remove/<%= product._id %>\" class=\"d-inline\">\r\n-                    <button class=\"btn btn-sm btn-outline-danger\" onclick=\"return confirm('Remove this item?')\">\r\n-                      Remove\r\n-                    </button>\r\n-                  </form>\r\n+                  <% if (product) { %>\r\n+                    <form method=\"POST\" action=\"/cart/remove/<%= product._id %>\" class=\"d-inline\">\r\n+                      <button class=\"btn btn-sm btn-outline-danger\" onclick=\"return confirm('Remove this item?')\">\r\n+                        Remove\r\n+                      </button>\r\n+                    </form>\r\n+                  <% } %>\r\n                 </td>\r\n               </tr>\r\n             <% } %>\r\n           </tbody>\r\n"
                }
            ],
            "date": 1765397697965,
            "name": "Commit-0",
            "content": "<!-- cart.ejs -->\r\n\r\n<div class=\"d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mb-4 mt-3\">\r\n  <div>\r\n    <h1 class=\"h3 fw-bold mb-1\">Your Cart</h1>\r\n    <p class=\"text-muted mb-0\">Review your items before checkout.</p>\r\n  </div>\r\n\r\n  <div class=\"d-flex gap-2\">\r\n    <a href=\"/\" class=\"btn btn-outline-primary\">\r\n      ‚Üê Continue Shopping\r\n    </a>\r\n    <a href=\"/checkout\" class=\"btn btn-primary\">\r\n      Proceed to Checkout\r\n    </a>\r\n  </div>\r\n</div>\r\n\r\n<% if (!products || products.length === 0) { %>\r\n  <div class=\"card border-0 shadow-sm\">\r\n    <div class=\"card-body p-4 p-md-5 text-center\">\r\n      <div class=\"display-6 mb-2\">üõí</div>\r\n      <h2 class=\"h5 fw-semibold\">Your cart is empty</h2>\r\n      <p class=\"text-muted mb-4\">Looks like you haven‚Äôt added anything yet.</p>\r\n      <a href=\"/\" class=\"btn btn-primary px-4\">\r\n        Start Shopping\r\n      </a>\r\n    </div>\r\n  </div>\r\n<% } else { %>\r\n\r\n  <div class=\"card border-0 shadow-sm\">\r\n    <div class=\"card-body p-0\">\r\n\r\n      <div class=\"table-responsive\">\r\n        <table class=\"table table-hover align-middle mb-0\">\r\n          <thead class=\"table-light\">\r\n            <tr>\r\n              <th class=\"ps-4\">Product Name</th>\r\n              <th class=\"text-end pe-4\">Product Price</th>\r\n            </tr>\r\n          </thead>\r\n\r\n          <!-- =========================================\r\n               BUGGY ORIGINAL (invalid HTML structure)\r\n               tfoot was inside tbody.\r\n          ========================================== -->\r\n          <% if (false) { %>\r\n            <tbody>\r\n              <% for(var i=0;i<products.length;i++) {let product = products[i];%>\r\n                <tr>\r\n                  <td><%=product.name  %> </td>\r\n                  <td><%=product.price  %> </td>\r\n                </tr>\r\n              <% } %> \r\n              <tfoot>\r\n                <tr>\r\n                  <td>Total:</td>\r\n                  <td><%=total  %> </td>\r\n                </tr>\r\n              </tfoot>\r\n            </tbody>\r\n          <% } %>\r\n\r\n          <!-- ‚úÖ Fixed structure -->\r\n          <tbody>\r\n            <% for (var i = 0; i < products.length; i++) { let product = products[i]; %>\r\n              <tr>\r\n                <td class=\"ps-4\">\r\n                  <div class=\"fw-semibold\"><%= product.name %></div>\r\n                  <div class=\"text-muted small\">Item <%= i + 1 %></div>\r\n                </td>\r\n                <td class=\"text-end pe-4 fw-semibold\">\r\n                  <%= product.price %>\r\n                </td>\r\n              </tr>\r\n            <% } %>\r\n          </tbody>\r\n\r\n          <tfoot class=\"table-light\">\r\n            <tr>\r\n              <td class=\"ps-4\">\r\n                <span class=\"fw-semibold\">Total</span>\r\n              </td>\r\n              <td class=\"text-end pe-4\">\r\n                <span class=\"fw-bold fs-5\"><%= total %></span>\r\n              </td>\r\n            </tr>\r\n          </tfoot>\r\n\r\n        </table>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-3\">\r\n    <small class=\"text-muted\">\r\n      Prices shown are before delivery/taxes (if applicable).\r\n    </small>\r\n\r\n    <div class=\"d-flex gap-2\">\r\n      <a href=\"/\" class=\"btn btn-outline-primary\">\r\n        ‚Üê Continue Shopping\r\n      </a>\r\n      <a href=\"/checkout\" class=\"btn btn-primary\">\r\n        Proceed to Checkout\r\n      </a>\r\n    </div>\r\n  </div>\r\n\r\n<% } %>\r\n"
        }
    ]
}