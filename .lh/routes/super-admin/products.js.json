{
    "sourceFile": "routes/super-admin/products.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1765447422257,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766085210159,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,8 +32,9 @@\n       color,\r\n       department,\r\n       description,\r\n       image,\r\n+      quantity: quantity !== undefined && quantity !== '' ? Number(quantity) : 0,\r\n     });\r\n \r\n     await newProduct.save();\r\n     res.redirect('/super-admin/products');\r\n"
                },
                {
                    "date": 1766085257352,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,107 @@\n+const express = require('express');\r\n+let Product = require('../../models/Product');\r\n+let router = express.Router();\r\n+const multer = require('multer');\r\n+const path = require('path');\r\n+\r\n+// Multer config\r\n+const storage = multer.diskStorage({\r\n+  destination: function (req, file, cb) {\r\n+    cb(null, 'public/images/uploaded');\r\n+  },\r\n+  filename: function (req, file, cb) {\r\n+    cb(null, Date.now() + '-' + file.originalname);\r\n+  },\r\n+});\r\n+const upload = multer({ storage: storage });\r\n+\r\n+// GET - render create form\r\n+router.get('/products/create', (req, res) => {\r\n+  res.render('super-admin/products/create');\r\n+});\r\n+\r\n+// POST - handle form submission\r\n+router.post('/products/create', upload.single('image'), async (req, res) => {\r\n+  try {\r\n+    const { name, price, color, department, description, quantity } = req.body;\r\n+    const image = req.file ? req.file.filename : null;\r\n+\r\n+    const newProduct = new Product({\r\n+      name,\r\n+      price,\r\n+      color,\r\n+      department,\r\n+      description,\r\n+      image,\r\n+      quantity:\r\n+        quantity !== undefined && quantity !== '' ? Number(quantity) : 0, // ✅\r\n+    });\r\n+\r\n+    await newProduct.save();\r\n+    res.redirect('/super-admin/products');\r\n+  } catch (err) {\r\n+    console.error('Error creating product:', err);\r\n+    res.status(500).send('Failed to create product');\r\n+  }\r\n+});\r\n+\r\n+router.get('/products/delete/:id', async (req, res) => {\r\n+  try {\r\n+    await Product.findByIdAndDelete(req.params.id);\r\n+    res.redirect('/super-admin/products');\r\n+  } catch (err) {\r\n+    console.error('Error deleting product:', err);\r\n+    res.status(500).send('Failed to delete product');\r\n+  }\r\n+});\r\n+\r\n+router.get('/products/edit/:id', async (req, res) => {\r\n+  try {\r\n+    const product = await Product.findById(req.params.id);\r\n+    if (!product) return res.status(404).send('Product not found');\r\n+\r\n+    res.render('super-admin/products/edit', { product });\r\n+  } catch (err) {\r\n+    console.error('Error fetching product for edit:', err);\r\n+    res.status(500).send('Internal Server Error');\r\n+  }\r\n+});\r\n+\r\n+// POST - update product\r\n+router.post('/products/edit/:id', upload.single('image'), async (req, res) => {\r\n+  try {\r\n+    const { name, price, color, department, description, quantity } = req.body;\r\n+\r\n+    const updateData = {\r\n+      name,\r\n+      price,\r\n+      color,\r\n+      department,\r\n+      description,\r\n+      quantity:\r\n+        quantity !== undefined && quantity !== '' ? Number(quantity) : 0, // ✅\r\n+    };\r\n+\r\n+    if (req.file) {\r\n+      updateData.image = req.file.filename;\r\n+    }\r\n+\r\n+    await Product.findByIdAndUpdate(req.params.id, updateData);\r\n+    res.redirect('/super-admin/products');\r\n+  } catch (err) {\r\n+    console.error('Error updating product:', err);\r\n+    res.status(500).send('Failed to update product');\r\n+  }\r\n+});\r\n+\r\n+router.get('/products', async (req, res) => {\r\n+  try {\r\n+    const products = await Product.find({});\r\n+    res.render('super-admin/products/list', { products });\r\n+  } catch (err) {\r\n+    console.error('Error fetching products:', err);\r\n+    res.status(500).send('Internal Server Error');\r\n+  }\r\n+});\r\n+\r\n+module.exports = router;\r\n"
                }
            ],
            "date": 1765447422257,
            "name": "Commit-0",
            "content": "const express = require(\"express\");\r\nlet Product = require(\"../../models/Product\");\r\nlet router = express.Router();\r\nconst multer = require(\"multer\");\r\nconst path = require(\"path\");\r\n\r\n// Multer config\r\nconst storage = multer.diskStorage({\r\n  destination: function (req, file, cb) {\r\n    cb(null, \"public/images/uploaded\");\r\n  },\r\n  filename: function (req, file, cb) {\r\n    cb(null, Date.now() + \"-\" + file.originalname);\r\n  },\r\n});\r\nconst upload = multer({ storage: storage });\r\n\r\n// GET - render create form\r\nrouter.get(\"/products/create\", (req, res) => {\r\n  res.render(\"super-admin/products/create\");\r\n});\r\n\r\n// POST - handle form submission\r\nrouter.post(\"/products/create\", upload.single(\"image\"), async (req, res) => {\r\n  try {\r\n    const { name, price, color, department, description } = req.body;\r\n    const image = req.file ? req.file.filename : null;\r\n\r\n    const newProduct = new Product({\r\n      name,\r\n      price,\r\n      color,\r\n      department,\r\n      description,\r\n      image,\r\n    });\r\n\r\n    await newProduct.save();\r\n    res.redirect(\"/super-admin/products\");\r\n  } catch (err) {\r\n    console.error(\"Error creating product:\", err);\r\n    res.status(500).send(\"Failed to create product\");\r\n  }\r\n});\r\nrouter.get(\"/products/delete/:id\", async (req, res) => {\r\n  try {\r\n    await Product.findByIdAndDelete(req.params.id);\r\n    res.redirect(\"/super-admin/products\");\r\n  } catch (err) {\r\n    console.error(\"Error deleting product:\", err);\r\n    res.status(500).send(\"Failed to delete product\");\r\n  }\r\n});\r\nrouter.get(\"/products/edit/:id\", async (req, res) => {\r\n  try {\r\n    const product = await Product.findById(req.params.id);\r\n    if (!product) return res.status(404).send(\"Product not found\");\r\n\r\n    res.render(\"super-admin/products/edit\", { product });\r\n  } catch (err) {\r\n    console.error(\"Error fetching product for edit:\", err);\r\n    res.status(500).send(\"Internal Server Error\");\r\n  }\r\n});\r\n\r\n// POST - update product\r\nrouter.post(\"/products/edit/:id\", upload.single(\"image\"), async (req, res) => {\r\n  try {\r\n    const { name, price, color, department, description } = req.body;\r\n    const updateData = { name, price, color, department, description };\r\n\r\n    if (req.file) {\r\n      updateData.image = req.file.filename;\r\n    }\r\n\r\n    await Product.findByIdAndUpdate(req.params.id, updateData);\r\n    res.redirect(\"/super-admin/products\");\r\n  } catch (err) {\r\n    console.error(\"Error updating product:\", err);\r\n    res.status(500).send(\"Failed to update product\");\r\n  }\r\n});\r\nrouter.get(\"/products\", async (req, res) => {\r\n  try {\r\n    const products = await Product.find({});\r\n    res.render(\"super-admin/products/list\", { products });\r\n  } catch (err) {\r\n    console.error(\"Error fetching products:\", err);\r\n    res.status(500).send(\"Internal Server Error\");\r\n  }\r\n});\r\nmodule.exports = router;\r\n"
        }
    ]
}