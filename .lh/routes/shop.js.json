{
    "sourceFile": "routes/shop.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1766083805443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1766083925445,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,9 +42,9 @@\n     totalPages,\r\n   });\r\n });\r\n \r\n-router.get('/:Catagorys?', async function (req, res, next) {\r\n+router.get('/:categories?', async function (req, res, next) {\r\n   let catagories = await Category;\r\n   let Categorys = [shirt, pant, beg, trousels, dresses];\r\n   // return res.send({ page, pageSize, skip });\r\n   return res.render('site/collections/Catetorys', {\r\n"
                },
                {
                    "date": 1766083931088,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,127 @@\n+var express = require('express');\r\n+var router = express.Router();\r\n+var Product = require('../models/Product');\r\n+const Category = require('../models/Category');\r\n+router.get('/cart', async function (req, res, next) {\r\n+  let cart = req.cookies.cart;\r\n+  if (!cart) cart = [];\r\n+  let products = await Product.find({ _id: { $in: cart } });\r\n+\r\n+  let total = products.reduce(\r\n+    (total, product) => total + Number(product.price),\r\n+    0\r\n+  );\r\n+\r\n+  res.render('site/cart', { products, total });\r\n+});\r\n+router.get('/add-cart/:id', function (req, res, next) {\r\n+  let cart = req.cookies.cart;\r\n+  if (!cart) cart = [];\r\n+  cart.push(req.params.id);\r\n+  res.cookie('cart', cart);\r\n+  req.flash('success', 'Product Added To Cart');\r\n+  res.redirect('/');\r\n+});\r\n+\r\n+router.get('/:page?', async function (req, res, next) {\r\n+  let page = Number(req.params.page);\r\n+  let pageSize = 10;\r\n+  let skip = (page - 1) * pageSize;\r\n+  if (!page) page = 1;\r\n+  if (!skip) skip = 0;\r\n+\r\n+  // return res.send({ page, pageSize, skip });\r\n+  let products = await Product.find().skip(skip).limit(pageSize);\r\n+  let totalProducts = await Product.countDocuments();\r\n+  let totalPages = Math.ceil(totalProducts / pageSize);\r\n+  return res.render('site/homepage', {\r\n+    pagetitle: 'Awesome Products',\r\n+    products,\r\n+    page,\r\n+    pageSize,\r\n+    totalPages,\r\n+  });\r\n+});\r\n+\r\n+router.get('/:categories?', async function (req, res, next) {\r\n+  let catagories = await Category;\r\n+  let Categorys = [shirt, pant, beg, trousels, dresses];\r\n+  // return res.send({ page, pageSize, skip });\r\n+  return res.render('site/collections/Catetorys', {\r\n+    Category_title: 'All Catagories',\r\n+    catagories,\r\n+    Categorys,\r\n+  });\r\n+});\r\n+\r\n+router.get('/:page?', async function (req, res, next) {\r\n+  let page = Number(req.params.page);\r\n+  if (!page || page < 1) page = 1;\r\n+\r\n+  const pageSize = 12;\r\n+  const skip = (page - 1) * pageSize;\r\n+\r\n+  // filters from query\r\n+  const dept = (req.query.dept || '').trim();\r\n+  const min = req.query.min ? Number(req.query.min) : null;\r\n+  const max = req.query.max ? Number(req.query.max) : null;\r\n+\r\n+  // build match for aggregation (price is String -> convert)\r\n+  const match = {};\r\n+  if (dept) match.department = dept;\r\n+\r\n+  // price filter will apply on priceNum (converted)\r\n+  if (min !== null || max !== null) {\r\n+    match.priceNum = {};\r\n+    if (min !== null && !Number.isNaN(min)) match.priceNum.$gte = min;\r\n+    if (max !== null && !Number.isNaN(max)) match.priceNum.$lte = max;\r\n+  }\r\n+\r\n+  // departments list for dropdown\r\n+  const departments = await Product.distinct('department');\r\n+\r\n+  // build querystring to keep filters in pagination links\r\n+  const queryObj = {};\r\n+  if (dept) queryObj.dept = dept;\r\n+  if (min !== null && !Number.isNaN(min)) queryObj.min = String(min);\r\n+  if (max !== null && !Number.isNaN(max)) queryObj.max = String(max);\r\n+  const qs = new URLSearchParams(queryObj).toString(); // \"dept=...&min=...&max=...\"\r\n+\r\n+  // fetch paged products using aggregation (convert price -> priceNum)\r\n+  const products = await Product.aggregate([\r\n+    {\r\n+      $addFields: {\r\n+        priceNum: { $toDouble: '$price' },\r\n+      },\r\n+    },\r\n+    { $match: match },\r\n+    { $skip: skip },\r\n+    { $limit: pageSize },\r\n+  ]);\r\n+\r\n+  // count total filtered products\r\n+  const countArr = await Product.aggregate([\r\n+    {\r\n+      $addFields: {\r\n+        priceNum: { $toDouble: '$price' },\r\n+      },\r\n+    },\r\n+    { $match: match },\r\n+    { $count: 'total' },\r\n+  ]);\r\n+  const totalProducts = countArr[0]?.total || 0;\r\n+  const totalPages = Math.max(1, Math.ceil(totalProducts / pageSize));\r\n+\r\n+  return res.render('site/homepage', {\r\n+    pagetitle: 'Awesome Products',\r\n+    products,\r\n+    page,\r\n+    pageSize,\r\n+    totalPages,\r\n+    departments,\r\n+    filters: { dept, min: min ?? '', max: max ?? '' },\r\n+    qs, // used by homepage.ejs to keep filters in pagination\r\n+  });\r\n+});\r\n+\r\n+module.exports = router;\r\n"
                }
            ],
            "date": 1766083805443,
            "name": "Commit-0",
            "content": "var express = require(\"express\");\r\nvar router = express.Router();\r\nvar Product = require(\"../models/Product\");\r\nconst Category = require(\"../models/Category\");\r\nrouter.get(\"/cart\", async function (req, res, next) {\r\n  let cart = req.cookies.cart;\r\n  if (!cart) cart = [];\r\n  let products = await Product.find({ _id: { $in: cart } });\r\n\r\n  let total = products.reduce(\r\n    (total, product) => total + Number(product.price),\r\n    0\r\n  );\r\n\r\n  res.render(\"site/cart\", { products, total });\r\n});\r\nrouter.get(\"/add-cart/:id\", function (req, res, next) {\r\n  let cart = req.cookies.cart;\r\n  if (!cart) cart = [];\r\n  cart.push(req.params.id);\r\n  res.cookie(\"cart\", cart);\r\n  req.flash(\"success\", \"Product Added To Cart\");\r\n  res.redirect(\"/\");\r\n});\r\n\r\nrouter.get(\"/:page?\", async function (req, res, next) {\r\n  let page = Number(req.params.page);\r\n  let pageSize = 10;\r\n  let skip = (page - 1) * pageSize;\r\n  if (!page) page = 1;\r\n  if (!skip) skip = 0;\r\n\r\n  // return res.send({ page, pageSize, skip });\r\n  let products = await Product.find().skip(skip).limit(pageSize);\r\n  let totalProducts = await Product.countDocuments();\r\n  let totalPages = Math.ceil(totalProducts / pageSize);\r\n  return res.render(\"site/homepage\", {\r\n    pagetitle: \"Awesome Products\",\r\n    products,\r\n    page,\r\n    pageSize,\r\n    totalPages,\r\n  });\r\n});\r\n\r\nrouter.get(\"/:Catagorys?\", async function (req, res, next) {\r\n  let catagories = await Category;\r\n  let Categorys = [shirt, pant, beg, trousels, dresses];\r\n      // return res.send({ page, pageSize, skip });\r\n  return res.render(\"site/collections/Catetorys\", {\r\n    Category_title: \"All Catagories\",\r\n      catagories,\r\n      Categorys,\r\n  \r\n  });\r\n});\r\n\r\nrouter.get(\"/:page?\", async function (req, res, next) {\r\n  let page = Number(req.params.page);\r\n  if (!page || page < 1) page = 1;\r\n\r\n  const pageSize = 12;\r\n  const skip = (page - 1) * pageSize;\r\n\r\n  // filters from query\r\n  const dept = (req.query.dept || \"\").trim();\r\n  const min = req.query.min ? Number(req.query.min) : null;\r\n  const max = req.query.max ? Number(req.query.max) : null;\r\n\r\n  // build match for aggregation (price is String -> convert)\r\n  const match = {};\r\n  if (dept) match.department = dept;\r\n\r\n  // price filter will apply on priceNum (converted)\r\n  if (min !== null || max !== null) {\r\n    match.priceNum = {};\r\n    if (min !== null && !Number.isNaN(min)) match.priceNum.$gte = min;\r\n    if (max !== null && !Number.isNaN(max)) match.priceNum.$lte = max;\r\n  }\r\n\r\n  // departments list for dropdown\r\n  const departments = await Product.distinct(\"department\");\r\n\r\n  // build querystring to keep filters in pagination links\r\n  const queryObj = {};\r\n  if (dept) queryObj.dept = dept;\r\n  if (min !== null && !Number.isNaN(min)) queryObj.min = String(min);\r\n  if (max !== null && !Number.isNaN(max)) queryObj.max = String(max);\r\n  const qs = new URLSearchParams(queryObj).toString(); // \"dept=...&min=...&max=...\"\r\n\r\n  // fetch paged products using aggregation (convert price -> priceNum)\r\n  const products = await Product.aggregate([\r\n    {\r\n      $addFields: {\r\n        priceNum: { $toDouble: \"$price\" },\r\n      },\r\n    },\r\n    { $match: match },\r\n    { $skip: skip },\r\n    { $limit: pageSize },\r\n  ]);\r\n\r\n  // count total filtered products\r\n  const countArr = await Product.aggregate([\r\n    {\r\n      $addFields: {\r\n        priceNum: { $toDouble: \"$price\" },\r\n      },\r\n    },\r\n    { $match: match },\r\n    { $count: \"total\" },\r\n  ]);\r\n  const totalProducts = countArr[0]?.total || 0;\r\n  const totalPages = Math.max(1, Math.ceil(totalProducts / pageSize));\r\n\r\n  return res.render(\"site/homepage\", {\r\n    pagetitle: \"Awesome Products\",\r\n    products,\r\n    page,\r\n    pageSize,\r\n    totalPages,\r\n    departments,\r\n    filters: { dept, min: min ?? \"\", max: max ?? \"\" },\r\n    qs, // used by homepage.ejs to keep filters in pagination\r\n  });\r\n});\r\n\r\n\r\nmodule.exports = router;\r\n"
        }
    ]
}